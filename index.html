<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Albert Ojwang Case Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; background: #f9f9f9; color: #333; }
    nav a { margin-right: 1em; text-decoration: none; color: #007BFF; }
    nav a:hover { text-decoration: underline; }
    h1, h2 { color: #222; }
    section { margin-bottom: 2em; }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; }
    th, td { border: 1px solid #ddd; padding: 0.75em; text-align: left; vertical-align: top; }
    th { background-color: #eee; }
    .highlight { background-color: #fff3cd; }
    .conflict { background-color: #f8d7da; }
    .loading { font-style: italic; color: #666; }
  </style>
</head>
<body>

  <h1>Albert Ojwang Case Tracker</h1>
  <nav>
    <a href="#timeline">üìÖ Timeline</a>
    <a href="#conflicts">‚ö†Ô∏è Contradictions</a>
    <a href="#submit">‚úèÔ∏è Submit Info</a>
  </nav>

  <section id="timeline">
    <h2>üïí Timeline of Events</h2>
    <div class="loading">Loading timeline‚Ä¶</div>
  </section>

  <section id="conflicts">
    <h2>üîç Contradictions in Official Narrative</h2>
    <div class="loading">Loading conflicts‚Ä¶</div>
  </section>

  <section id="submit">
    <h2>‚úèÔ∏è Submit New Info</h2>
    <form id="crowdForm">
      <label>Date/Time:<br><input type="datetime-local" name="datetime" required></label><br><br>
      <label>Type:<br>
        <select name="type" required>
          <option value="" disabled selected>Select...</option>
          <option value="timeline">Timeline Event</option>
          <option value="conflicts">Contradiction</option>
        </select>
      </label><br><br>
      <label>Description:<br><textarea name="description" rows="4" required></textarea></label><br><br>
      <button type="submit">Submit</button>
    </form>
    <div id="formMsg"></div>
  </section>

  <script>
    async function loadData() {
      try {
        const res = await fetch('/data');
        const { timeline, conflicts } = await res.json();
        renderTable('timeline', timeline, 'highlight');
        renderTable('conflicts', conflicts, 'conflict');
      } catch (err) {
        document.querySelectorAll('.loading').forEach(el => el.textContent = 'Failed to load data.');
      }
    }

    function renderTable(sectionId, items, rowClass) {
      const sec = document.getElementById(sectionId);
      const tbl = document.createElement('table');
      tbl.innerHTML = '<thead><tr><th>Date/Time</th><th>Description</th></tr></thead>';
      const tbody = document.createElement('tbody');
      items.sort((a, b) => new Date(a.datetime) - new Date(b.datetime));
      items.forEach(item => {
        const tr = document.createElement('tr');
        if (item.highlight && sectionId === 'timeline') tr.classList.add(rowClass);
        else if (sectionId === 'conflicts') tr.classList.add(rowClass);
        tr.innerHTML = `<td>${new Date(item.datetime).toLocaleString()}</td><td>${item.description}</td>`;
        tbody.appendChild(tr);
      });
      tbl.appendChild(tbody);
      sec.innerHTML = '';
      sec.appendChild(tbl);
    }

    document.getElementById('crowdForm').addEventListener('submit', async e => {
      e.preventDefault();
      const form = e.target;
      const data = {
        datetime: form.datetime.value,
        description: form.description.value.trim(),
        highlight: false
      };
      const endpoint = form.type.value;
      const res = await fetch(`/${endpoint}`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });
      const msg = await res.text();
      document.getElementById('formMsg').textContent = res.ok ? '‚úÖ Submitted' : '‚ùå Error';
      form.reset();
      loadData();
    });

    loadData();
  </script>
</body>
</html>